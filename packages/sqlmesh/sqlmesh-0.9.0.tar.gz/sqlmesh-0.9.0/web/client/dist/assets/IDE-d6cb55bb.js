import{r as c,j as se,L as W,y as Q,a as Ue,o as w,R as O,c as Ke,u as H,d as V,D as Y,I as _,p as Qe,s as Ve,n as ve,C as Re,l as ie,h as _e,F as He,b as F,e as ke,f as Se,v as tt,g as K,i as We,A as nt,T as rt,E as Fe,k as Oe,m as at,q as Ye,t as je,w as we,x as te,z as st,B as q,N as Ne,G as U,H as B,J as qe,K as lt,M as de,O as k,P as ee,Q as ue,S as r,U as L,V as ne,W as ce,X as re,Y as X,Z as ot,_ as Je,$ as le,a0 as J,a1 as it,a2 as ut,a3 as xe,a4 as ct,a5 as Ce,a6 as dt,a7 as mt,a8 as Xe,a9 as be,aa as pt,ab as ft,ac as vt,ad as xt,ae as Pe,af as ht,ag as gt,ah as yt,ai as bt,aj as Pt,ak as oe,al as It,am as Et,an as St,ao as Le,ap as jt}from"./index-2ae943fc.js";import{F as wt,P as Be,u as Nt}from"./channels-7a3d138e.js";import{T as Ie}from"./TasksOverview-aa79095f.js";function Ct(e){throw new Error("Unexpected object: "+e)}var G=(e=>(e[e.First=0]="First",e[e.Previous=1]="Previous",e[e.Next=2]="Next",e[e.Last=3]="Last",e[e.Specific=4]="Specific",e[e.Nothing=5]="Nothing",e))(G||{});function Rt(e,t){let l=t.resolveItems();if(l.length<=0)return null;let a=t.resolveActiveIndex(),d=a??-1,i=(()=>{switch(e.focus){case 0:return l.findIndex(n=>!t.resolveDisabled(n));case 1:{let n=l.slice().reverse().findIndex((s,u,b)=>d!==-1&&b.length-u-1>=d?!1:!t.resolveDisabled(s));return n===-1?n:l.length-1-n}case 2:return l.findIndex((n,s)=>s<=d?!1:!t.resolveDisabled(n));case 3:{let n=l.slice().reverse().findIndex(s=>!t.resolveDisabled(s));return n===-1?n:l.length-1-n}case 4:return l.findIndex(n=>t.resolveId(n)===e.id);case 5:return null;default:Ct(e)}})();return i===-1?a:i}function ze(e){return[e.screenX,e.screenY]}function kt(){let e=c.useRef([-1,-1]);return{wasMoved(t){let l=ze(t);return e.current[0]===l[0]&&e.current[1]===l[1]?!1:(e.current=l,!0)},update(t){e.current=ze(t)}}}var Ft=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ft||{}),At=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(At||{}),Tt=(e=>(e[e.OpenMenu=0]="OpenMenu",e[e.CloseMenu=1]="CloseMenu",e[e.GoToItem=2]="GoToItem",e[e.Search=3]="Search",e[e.ClearSearch=4]="ClearSearch",e[e.RegisterItem=5]="RegisterItem",e[e.UnregisterItem=6]="UnregisterItem",e))(Tt||{});function Ee(e,t=l=>l){let l=e.activeItemIndex!==null?e.items[e.activeItemIndex]:null,a=nt(t(e.items.slice()),i=>i.dataRef.current.domRef.current),d=l?a.indexOf(l):null;return d===-1&&(d=null),{items:a,activeItemIndex:d}}let Mt={[1](e){return e.menuState===1?e:{...e,activeItemIndex:null,menuState:1}},[0](e){return e.menuState===0?e:{...e,menuState:0}},[2]:(e,t)=>{var l;let a=Ee(e),d=Rt(t,{resolveItems:()=>a.items,resolveActiveIndex:()=>a.activeItemIndex,resolveId:i=>i.id,resolveDisabled:i=>i.dataRef.current.disabled});return{...e,...a,searchQuery:"",activeItemIndex:d,activationTrigger:(l=t.trigger)!=null?l:1}},[3]:(e,t)=>{let l=e.searchQuery!==""?0:1,a=e.searchQuery+t.value.toLowerCase(),d=(e.activeItemIndex!==null?e.items.slice(e.activeItemIndex+l).concat(e.items.slice(0,e.activeItemIndex+l)):e.items).find(n=>{var s;return((s=n.dataRef.current.textValue)==null?void 0:s.startsWith(a))&&!n.dataRef.current.disabled}),i=d?e.items.indexOf(d):-1;return i===-1||i===e.activeItemIndex?{...e,searchQuery:a}:{...e,searchQuery:a,activeItemIndex:i,activationTrigger:1}},[4](e){return e.searchQuery===""?e:{...e,searchQuery:"",searchActiveItemIndex:null}},[5]:(e,t)=>{let l=Ee(e,a=>[...a,{id:t.id,dataRef:t.dataRef}]);return{...e,...l}},[6]:(e,t)=>{let l=Ee(e,a=>{let d=a.findIndex(i=>i.id===t.id);return d!==-1&&a.splice(d,1),a});return{...e,...l,activationTrigger:1}}},Ae=c.createContext(null);Ae.displayName="MenuContext";function he(e){let t=c.useContext(Ae);if(t===null){let l=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,he),l}return t}function Dt(e,t){return H(t.type,Mt,e,t)}let $t=c.Fragment;function Ot(e,t){let l=c.useReducer(Dt,{menuState:1,buttonRef:c.createRef(),itemsRef:c.createRef(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:a,itemsRef:d,buttonRef:i},n]=l,s=Q(t);Ue([i,d],(m,j)=>{var x;n({type:1}),_e(j,He.Loose)||(m.preventDefault(),(x=i.current)==null||x.focus())},a===0);let u=w(()=>{n({type:1})}),b=c.useMemo(()=>({open:a===0,close:u}),[a,u]),g=e,p={ref:s};return O.createElement(Ae.Provider,{value:l},O.createElement(Ke,{value:H(a,{[0]:V.Open,[1]:V.Closed})},Y({ourProps:p,theirProps:g,slot:b,defaultTag:$t,name:"Menu"})))}let Lt="button";function Bt(e,t){var l;let a=_(),{id:d=`headlessui-menu-button-${a}`,...i}=e,[n,s]=he("Menu.Button"),u=Q(n.buttonRef,t),b=Qe(),g=w(o=>{switch(o.key){case F.Space:case F.Enter:case F.ArrowDown:o.preventDefault(),o.stopPropagation(),s({type:0}),b.nextFrame(()=>s({type:2,focus:G.First}));break;case F.ArrowUp:o.preventDefault(),o.stopPropagation(),s({type:0}),b.nextFrame(()=>s({type:2,focus:G.Last}));break}}),p=w(o=>{switch(o.key){case F.Space:o.preventDefault();break}}),m=w(o=>{if(ke(o.currentTarget))return o.preventDefault();e.disabled||(n.menuState===0?(s({type:1}),b.nextFrame(()=>{var I;return(I=n.buttonRef.current)==null?void 0:I.focus({preventScroll:!0})})):(o.preventDefault(),s({type:0})))}),j=c.useMemo(()=>({open:n.menuState===0}),[n]),x={ref:u,id:d,type:Ve(e,n.buttonRef),"aria-haspopup":"menu","aria-controls":(l=n.itemsRef.current)==null?void 0:l.id,"aria-expanded":e.disabled?void 0:n.menuState===0,onKeyDown:g,onKeyUp:p,onClick:m};return Y({ourProps:x,theirProps:i,slot:j,defaultTag:Lt,name:"Menu.Button"})}let zt="div",Gt=se.RenderStrategy|se.Static;function Ut(e,t){var l,a;let d=_(),{id:i=`headlessui-menu-items-${d}`,...n}=e,[s,u]=he("Menu.Items"),b=Q(s.itemsRef,t),g=ve(s.itemsRef),p=Qe(),m=Re(),j=(()=>m!==null?(m&V.Open)===V.Open:s.menuState===0)();c.useEffect(()=>{let f=s.itemsRef.current;f&&s.menuState===0&&f!==(g==null?void 0:g.activeElement)&&f.focus({preventScroll:!0})},[s.menuState,s.itemsRef,g]),wt({container:s.itemsRef.current,enabled:s.menuState===0,accept(f){return f.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:f.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(f){f.setAttribute("role","none")}});let x=w(f=>{var A,S;switch(p.dispose(),f.key){case F.Space:if(s.searchQuery!=="")return f.preventDefault(),f.stopPropagation(),u({type:3,value:f.key});case F.Enter:if(f.preventDefault(),f.stopPropagation(),u({type:1}),s.activeItemIndex!==null){let{dataRef:v}=s.items[s.activeItemIndex];(S=(A=v.current)==null?void 0:A.domRef.current)==null||S.click()}We(s.buttonRef.current);break;case F.ArrowDown:return f.preventDefault(),f.stopPropagation(),u({type:2,focus:G.Next});case F.ArrowUp:return f.preventDefault(),f.stopPropagation(),u({type:2,focus:G.Previous});case F.Home:case F.PageUp:return f.preventDefault(),f.stopPropagation(),u({type:2,focus:G.First});case F.End:case F.PageDown:return f.preventDefault(),f.stopPropagation(),u({type:2,focus:G.Last});case F.Escape:f.preventDefault(),f.stopPropagation(),u({type:1}),Se().nextFrame(()=>{var v;return(v=s.buttonRef.current)==null?void 0:v.focus({preventScroll:!0})});break;case F.Tab:f.preventDefault(),f.stopPropagation(),u({type:1}),Se().nextFrame(()=>{tt(s.buttonRef.current,f.shiftKey?K.Previous:K.Next)});break;default:f.key.length===1&&(u({type:3,value:f.key}),p.setTimeout(()=>u({type:4}),350));break}}),o=w(f=>{switch(f.key){case F.Space:f.preventDefault();break}}),I=c.useMemo(()=>({open:s.menuState===0}),[s]),N={"aria-activedescendant":s.activeItemIndex===null||(l=s.items[s.activeItemIndex])==null?void 0:l.id,"aria-labelledby":(a=s.buttonRef.current)==null?void 0:a.id,id:i,onKeyDown:x,onKeyUp:o,role:"menu",tabIndex:0,ref:b};return Y({ourProps:N,theirProps:n,slot:I,defaultTag:zt,features:Gt,visible:j,name:"Menu.Items"})}let Kt=c.Fragment;function Qt(e,t){let l=_(),{id:a=`headlessui-menu-item-${l}`,disabled:d=!1,...i}=e,[n,s]=he("Menu.Item"),u=n.activeItemIndex!==null?n.items[n.activeItemIndex].id===a:!1,b=c.useRef(null),g=Q(t,b);ie(()=>{if(n.menuState!==0||!u||n.activationTrigger===0)return;let S=Se();return S.requestAnimationFrame(()=>{var v,M;(M=(v=b.current)==null?void 0:v.scrollIntoView)==null||M.call(v,{block:"nearest"})}),S.dispose},[b,u,n.menuState,n.activationTrigger,n.activeItemIndex]);let p=c.useRef({disabled:d,domRef:b});ie(()=>{p.current.disabled=d},[p,d]),ie(()=>{var S,v;p.current.textValue=(v=(S=b.current)==null?void 0:S.textContent)==null?void 0:v.toLowerCase()},[p,b]),ie(()=>(s({type:5,id:a,dataRef:p}),()=>s({type:6,id:a})),[p,a]);let m=w(()=>{s({type:1})}),j=w(S=>{if(d)return S.preventDefault();s({type:1}),We(n.buttonRef.current)}),x=w(()=>{if(d)return s({type:2,focus:G.Nothing});s({type:2,focus:G.Specific,id:a})}),o=kt(),I=w(S=>o.update(S)),N=w(S=>{o.wasMoved(S)&&(d||u||s({type:2,focus:G.Specific,id:a,trigger:0}))}),f=w(S=>{o.wasMoved(S)&&(d||u&&s({type:2,focus:G.Nothing}))}),A=c.useMemo(()=>({active:u,disabled:d,close:m}),[u,d,m]);return Y({ourProps:{id:a,ref:g,role:"menuitem",tabIndex:d===!0?void 0:-1,"aria-disabled":d===!0?!0:void 0,disabled:void 0,onClick:j,onFocus:x,onPointerEnter:I,onMouseEnter:I,onPointerMove:N,onMouseMove:N,onPointerLeave:f,onMouseLeave:f},theirProps:i,slot:A,defaultTag:Kt,name:"Menu.Item"})}let Vt=W(Ot),_t=W(Bt),Ht=W(Ut),Wt=W(Qt),pe=Object.assign(Vt,{Button:_t,Items:Ht,Item:Wt});var Yt=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Yt||{}),qt=(e=>(e[e.TogglePopover=0]="TogglePopover",e[e.ClosePopover=1]="ClosePopover",e[e.SetButton=2]="SetButton",e[e.SetButtonId=3]="SetButtonId",e[e.SetPanel=4]="SetPanel",e[e.SetPanelId=5]="SetPanelId",e))(qt||{});let Jt={[0]:e=>({...e,popoverState:H(e.popoverState,{[0]:1,[1]:0})}),[1](e){return e.popoverState===1?e:{...e,popoverState:1}},[2](e,t){return e.button===t.button?e:{...e,button:t.button}},[3](e,t){return e.buttonId===t.buttonId?e:{...e,buttonId:t.buttonId}},[4](e,t){return e.panel===t.panel?e:{...e,panel:t.panel}},[5](e,t){return e.panelId===t.panelId?e:{...e,panelId:t.panelId}}},Te=c.createContext(null);Te.displayName="PopoverContext";function ge(e){let t=c.useContext(Te);if(t===null){let l=new Error(`<${e} /> is missing a parent <Popover /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,ge),l}return t}let Me=c.createContext(null);Me.displayName="PopoverAPIContext";function De(e){let t=c.useContext(Me);if(t===null){let l=new Error(`<${e} /> is missing a parent <Popover /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,De),l}return t}let $e=c.createContext(null);$e.displayName="PopoverGroupContext";function Ze(){return c.useContext($e)}let ye=c.createContext(null);ye.displayName="PopoverPanelContext";function Xt(){return c.useContext(ye)}function Zt(e,t){return H(t.type,Jt,e,t)}let en="div";function tn(e,t){var l;let a=c.useRef(null),d=Q(t,rt(y=>{a.current=y})),i=c.useRef([]),n=c.useReducer(Zt,{popoverState:1,buttons:i,button:null,buttonId:null,panel:null,panelId:null,beforePanelSentinel:c.createRef(),afterPanelSentinel:c.createRef()}),[{popoverState:s,button:u,buttonId:b,panel:g,panelId:p,beforePanelSentinel:m,afterPanelSentinel:j},x]=n,o=ve((l=a.current)!=null?l:u),I=c.useMemo(()=>{if(!u||!g)return!1;for(let me of document.querySelectorAll("body > *"))if(Number(me==null?void 0:me.contains(u))^Number(me==null?void 0:me.contains(g)))return!0;let y=Fe(),E=y.indexOf(u),D=(E+y.length-1)%y.length,z=(E+1)%y.length,C=y[D],Z=y[z];return!g.contains(C)&&!g.contains(Z)},[u,g]),N=Oe(b),f=Oe(p),A=c.useMemo(()=>({buttonId:N,panelId:f,close:()=>x({type:1})}),[N,f,x]),S=Ze(),v=S==null?void 0:S.registerPopover,M=w(()=>{var y;return(y=S==null?void 0:S.isFocusWithinPopoverGroup())!=null?y:(o==null?void 0:o.activeElement)&&((u==null?void 0:u.contains(o.activeElement))||(g==null?void 0:g.contains(o.activeElement)))});c.useEffect(()=>v==null?void 0:v(A),[v,A]),at(o==null?void 0:o.defaultView,"focus",y=>{var E,D,z,C;s===0&&(M()||u&&g&&y.target!==window&&((D=(E=m.current)==null?void 0:E.contains)!=null&&D.call(E,y.target)||(C=(z=j.current)==null?void 0:z.contains)!=null&&C.call(z,y.target)||x({type:1})))},!0),Ue([u,g],(y,E)=>{x({type:1}),_e(E,He.Loose)||(y.preventDefault(),u==null||u.focus())},s===0);let h=w(y=>{x({type:1});let E=(()=>y?y instanceof HTMLElement?y:"current"in y&&y.current instanceof HTMLElement?y.current:u:u)();E==null||E.focus()}),T=c.useMemo(()=>({close:h,isPortalled:I}),[h,I]),R=c.useMemo(()=>({open:s===0,close:h}),[s,h]),$=e,P={ref:d};return O.createElement(ye.Provider,{value:null},O.createElement(Te.Provider,{value:n},O.createElement(Me.Provider,{value:T},O.createElement(Ke,{value:H(s,{[0]:V.Open,[1]:V.Closed})},Y({ourProps:P,theirProps:$,slot:R,defaultTag:en,name:"Popover"})))))}let nn="button";function rn(e,t){let l=_(),{id:a=`headlessui-popover-button-${l}`,...d}=e,[i,n]=ge("Popover.Button"),{isPortalled:s}=De("Popover.Button"),u=c.useRef(null),b=`headlessui-focus-sentinel-${_()}`,g=Ze(),p=g==null?void 0:g.closeOthers,m=Xt()!==null;c.useEffect(()=>{if(!m)return n({type:3,buttonId:a}),()=>{n({type:3,buttonId:null})}},[m,a,n]);let[j]=c.useState(()=>Symbol()),x=Q(u,t,m?null:P=>{if(P)i.buttons.current.push(j);else{let y=i.buttons.current.indexOf(j);y!==-1&&i.buttons.current.splice(y,1)}i.buttons.current.length>1&&console.warn("You are already using a <Popover.Button /> but only 1 <Popover.Button /> is supported."),P&&n({type:2,button:P})}),o=Q(u,t),I=ve(u),N=w(P=>{var y,E,D;if(m){if(i.popoverState===1)return;switch(P.key){case F.Space:case F.Enter:P.preventDefault(),(E=(y=P.target).click)==null||E.call(y),n({type:1}),(D=i.button)==null||D.focus();break}}else switch(P.key){case F.Space:case F.Enter:P.preventDefault(),P.stopPropagation(),i.popoverState===1&&(p==null||p(i.buttonId)),n({type:0});break;case F.Escape:if(i.popoverState!==0)return p==null?void 0:p(i.buttonId);if(!u.current||I!=null&&I.activeElement&&!u.current.contains(I.activeElement))return;P.preventDefault(),P.stopPropagation(),n({type:1});break}}),f=w(P=>{m||P.key===F.Space&&P.preventDefault()}),A=w(P=>{var y,E;ke(P.currentTarget)||e.disabled||(m?(n({type:1}),(y=i.button)==null||y.focus()):(P.preventDefault(),P.stopPropagation(),i.popoverState===1&&(p==null||p(i.buttonId)),n({type:0}),(E=i.button)==null||E.focus()))}),S=w(P=>{P.preventDefault(),P.stopPropagation()}),v=i.popoverState===0,M=c.useMemo(()=>({open:v}),[v]),h=Ve(e,u),T=m?{ref:o,type:h,onKeyDown:N,onClick:A}:{ref:x,id:i.buttonId,type:h,"aria-expanded":e.disabled?void 0:i.popoverState===0,"aria-controls":i.panel?i.panelId:void 0,onKeyDown:N,onKeyUp:f,onClick:A,onMouseDown:S},R=Ye(),$=w(()=>{let P=i.panel;if(!P)return;function y(){H(R.current,{[q.Forwards]:()=>te(P,K.First),[q.Backwards]:()=>te(P,K.Last)})===Ne.Error&&te(Fe().filter(E=>E.dataset.headlessuiFocusGuard!=="true"),H(R.current,{[q.Forwards]:K.Next,[q.Backwards]:K.Previous}),{relativeTo:i.button})}y()});return O.createElement(O.Fragment,null,Y({ourProps:T,theirProps:d,slot:M,defaultTag:nn,name:"Popover.Button"}),v&&!m&&s&&O.createElement(je,{id:b,features:we.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:$}))}let an="div",sn=se.RenderStrategy|se.Static;function ln(e,t){let l=_(),{id:a=`headlessui-popover-overlay-${l}`,...d}=e,[{popoverState:i},n]=ge("Popover.Overlay"),s=Q(t),u=Re(),b=(()=>u!==null?(u&V.Open)===V.Open:i===0)(),g=w(m=>{if(ke(m.currentTarget))return m.preventDefault();n({type:1})}),p=c.useMemo(()=>({open:i===0}),[i]);return Y({ourProps:{ref:s,id:a,"aria-hidden":!0,onClick:g},theirProps:d,slot:p,defaultTag:an,features:sn,visible:b,name:"Popover.Overlay"})}let on="div",un=se.RenderStrategy|se.Static;function cn(e,t){let l=_(),{id:a=`headlessui-popover-panel-${l}`,focus:d=!1,...i}=e,[n,s]=ge("Popover.Panel"),{close:u,isPortalled:b}=De("Popover.Panel"),g=`headlessui-focus-sentinel-before-${_()}`,p=`headlessui-focus-sentinel-after-${_()}`,m=c.useRef(null),j=Q(m,t,h=>{s({type:4,panel:h})}),x=ve(m);ie(()=>(s({type:5,panelId:a}),()=>{s({type:5,panelId:null})}),[a,s]);let o=Re(),I=(()=>o!==null?(o&V.Open)===V.Open:n.popoverState===0)(),N=w(h=>{var T;switch(h.key){case F.Escape:if(n.popoverState!==0||!m.current||x!=null&&x.activeElement&&!m.current.contains(x.activeElement))return;h.preventDefault(),h.stopPropagation(),s({type:1}),(T=n.button)==null||T.focus();break}});c.useEffect(()=>{var h;e.static||n.popoverState===1&&((h=e.unmount)==null||h)&&s({type:4,panel:null})},[n.popoverState,e.unmount,e.static,s]),c.useEffect(()=>{if(!d||n.popoverState!==0||!m.current)return;let h=x==null?void 0:x.activeElement;m.current.contains(h)||te(m.current,K.First)},[d,m,n.popoverState]);let f=c.useMemo(()=>({open:n.popoverState===0,close:u}),[n,u]),A={ref:j,id:a,onKeyDown:N,onBlur:d&&n.popoverState===0?h=>{var T,R,$,P,y;let E=h.relatedTarget;E&&m.current&&((T=m.current)!=null&&T.contains(E)||(s({type:1}),(($=(R=n.beforePanelSentinel.current)==null?void 0:R.contains)!=null&&$.call(R,E)||(y=(P=n.afterPanelSentinel.current)==null?void 0:P.contains)!=null&&y.call(P,E))&&E.focus({preventScroll:!0})))}:void 0,tabIndex:-1},S=Ye(),v=w(()=>{let h=m.current;if(!h)return;function T(){H(S.current,{[q.Forwards]:()=>{var R;te(h,K.First)===Ne.Error&&((R=n.afterPanelSentinel.current)==null||R.focus())},[q.Backwards]:()=>{var R;(R=n.button)==null||R.focus({preventScroll:!0})}})}T()}),M=w(()=>{let h=m.current;if(!h)return;function T(){H(S.current,{[q.Forwards]:()=>{var R;if(!n.button)return;let $=Fe(),P=$.indexOf(n.button),y=$.slice(0,P+1),E=[...$.slice(P+1),...y];for(let D of E.slice())if(D.dataset.headlessuiFocusGuard==="true"||(R=n.panel)!=null&&R.contains(D)){let z=E.indexOf(D);z!==-1&&E.splice(z,1)}te(E,K.First,{sorted:!1})},[q.Backwards]:()=>{var R;te(h,K.Previous)===Ne.Error&&((R=n.button)==null||R.focus())}})}T()});return O.createElement(ye.Provider,{value:a},I&&b&&O.createElement(je,{id:g,ref:n.beforePanelSentinel,features:we.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:v}),Y({ourProps:A,theirProps:i,slot:f,defaultTag:on,features:un,visible:I,name:"Popover.Panel"}),I&&b&&O.createElement(je,{id:p,ref:n.afterPanelSentinel,features:we.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:M}))}let dn="div";function mn(e,t){let l=c.useRef(null),a=Q(l,t),[d,i]=c.useState([]),n=w(x=>{i(o=>{let I=o.indexOf(x);if(I!==-1){let N=o.slice();return N.splice(I,1),N}return o})}),s=w(x=>(i(o=>[...o,x]),()=>n(x))),u=w(()=>{var x;let o=st(l);if(!o)return!1;let I=o.activeElement;return(x=l.current)!=null&&x.contains(I)?!0:d.some(N=>{var f,A;return((f=o.getElementById(N.buttonId.current))==null?void 0:f.contains(I))||((A=o.getElementById(N.panelId.current))==null?void 0:A.contains(I))})}),b=w(x=>{for(let o of d)o.buttonId.current!==x&&o.close()}),g=c.useMemo(()=>({registerPopover:s,unregisterPopover:n,isFocusWithinPopoverGroup:u,closeOthers:b}),[s,n,u,b]),p=c.useMemo(()=>({}),[]),m=e,j={ref:a};return O.createElement($e.Provider,{value:g},Y({ourProps:j,theirProps:m,slot:p,defaultTag:dn,name:"Popover.Group"}))}let pn=W(tn),fn=W(rn),vn=W(ln),xn=W(cn),hn=W(mn),ae=Object.assign(pn,{Button:fn,Overlay:vn,Panel:xn,Group:hn});function gn({showRunPlan:e}){var T,R,$,P,y,E,D,z;const t=U(C=>C.state),l=U(C=>C.action),a=U(C=>C.setState),d=U(C=>C.setAction),i=U(C=>C.setActivePlan),n=B(C=>C.environment),s=B(C=>C.environments),u=B(C=>C.setInitialDates),[b,g]=c.useState(!1),[p,m]=c.useState(!1),{refetch:j}=qe(),{refetch:x,data:o,error:I,isLoading:N,isError:f}=lt(n.name,{planOptions:{skip_tests:!0}}),A=c.useCallback(de(j,1e3,!0),[j]),S=c.useCallback(de(x,1e3,!0),[x]),v=c.useMemo(()=>n.isDefault?{headline:"Running Plan Directly On Prod Environment!",description:"Are you sure you want to run your changes directly on prod? Safer choice will be to select or add new environment first.",yesText:`Yes, Run ${n.name}`,noText:"No, Cancel",action(){M()}}:void 0,[n]);c.useEffect(()=>{S().finally(()=>{p&&(M(),m(!1))})},[n,p]),c.useEffect(()=>{t===k.Finished&&(S(),A())},[t]),c.useEffect(()=>{u(o==null?void 0:o.start,o==null?void 0:o.end)},[o]);function M(){i(void 0),a(k.Init),d(ee.Run),e()}const h=[(T=o==null?void 0:o.changes)==null?void 0:T.added,(R=o==null?void 0:o.changes)==null?void 0:R.removed,(P=($=o==null?void 0:o.changes)==null?void 0:$.modified)==null?void 0:P.direct,(E=(y=o==null?void 0:o.changes)==null?void 0:y.modified)==null?void 0:E.indirect,(z=(D=o==null?void 0:o.changes)==null?void 0:D.modified)==null?void 0:z.metadata].some(ue);return r.jsxs("div",{className:L("flex items-center",n==null&&"opacity-50 pointer-events-none cursor-not-allowed"),children:[r.jsxs("div",{className:"flex items-center relative",children:[r.jsxs(ne,{className:L("mx-0",ce(n.isInitial&&n.isDefault)&&"rounded-none rounded-l-lg border-r"),disabled:f||N||l!==ee.None||t===k.Applying||t===k.Running||t===k.Cancelling,variant:re.Alternative,size:X.sm,onClick:C=>{C.stopPropagation(),n.isDefault&&ce(n.isInitial)?g(!0):M()},children:[ot([k.Applying,k.Running,k.Cancelling],t)&&r.jsx(Je,{className:"w-3 h-3 mr-1"}),r.jsx("span",{className:"inline-block",children:t===k.Running?"Running Plan...":t===k.Applying?"Applying Plan...":t===k.Cancelling?"Cancelling Plan...":l!==ee.None?"Setting Plan...":"Run Plan"})]}),(ce(n.isInitial)||ce(n.isDefault))&&r.jsx(Ge,{className:"rounded-none rounded-r-lg border-l mx-0",environment:n,disabled:f||N||l!==ee.None||t===k.Applying||t===k.Running||t===k.Cancelling})]}),t!==k.Applying&&r.jsx(yn,{environment:n,plan:o,isLoading:N,isError:f,error:I,hasChanges:h}),r.jsxs(le,{show:b,onClose:()=>{},children:[r.jsxs(le.Main,{children:[(v==null?void 0:v.headline)!=null&&r.jsx(le.Headline,{children:v==null?void 0:v.headline}),(v==null?void 0:v.description)!=null&&r.jsx(le.Description,{children:v==null?void 0:v.description}),r.jsxs("div",{className:"mt-5 pt-4",children:[r.jsx("h4",{className:"mb-2",children:`${s.size>1?"Select or ":""}Add Environment`}),r.jsxs("div",{className:"flex items-center relative",children:[s.size>1&&r.jsx(Ge,{className:"mr-2",side:"left",environment:n,showAddEnvironemnt:!1,onSelect:()=>{m(!0),g(!1)},size:X.md,disabled:N||l!==ee.None||t===k.Applying||t===k.Cancelling}),r.jsx(et,{className:"w-full",size:X.md,onAdd:()=>{m(!0),g(!1)}})]})]})]}),r.jsxs(le.Actions,{children:[r.jsx(ne,{className:"font-bold",size:"md",variant:re.Primary,onClick:C=>{var Z;C.stopPropagation(),(Z=v==null?void 0:v.action)==null||Z.call(v),g(!1)},children:(v==null?void 0:v.yesText)??"Confirm"}),r.jsx(ne,{size:"md",variant:re.Neutral,onClick:C=>{var Z;C.stopPropagation(),(Z=v==null?void 0:v.cancel)==null||Z.call(v),g(!1)},children:(v==null?void 0:v.noText)??"Cancel"})]})]})]})}function yn({isLoading:e,hasChanges:t,environment:l,plan:a,isError:d,error:i}){var n,s,u,b,g,p,m,j,x,o;return r.jsx("span",{className:"flex align-center pr-2 h-full w-full",children:d&&i!=null?r.jsx(bn,{error:i}):r.jsxs(r.Fragment,{children:[l.isInitial&&r.jsx("span",{title:"New",className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-success-10 text-success-500 text-xs text-center font-bold",children:"New"}),e&&r.jsxs("span",{className:"flex items-center ml-2",children:[r.jsx(Je,{className:"w-3 h-3 mr-1"}),r.jsx("span",{className:"inline-block text-xs text-neutral-500",children:"Checking..."})]}),[t,e,l.isLocal].every(ce)&&r.jsx("span",{title:"Latest",className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-neutral-10 text-xs text-center",children:r.jsx("span",{children:"Latest"})}),((n=a==null?void 0:a.changes)==null?void 0:n.added)!=null&&ue((s=a==null?void 0:a.changes)==null?void 0:s.added)&&r.jsx(fe,{headline:"Added Models",type:J.Add,changes:a.changes.added}),((b=(u=a==null?void 0:a.changes)==null?void 0:u.modified)==null?void 0:b.direct)!=null&&ue((g=a==null?void 0:a.changes)==null?void 0:g.modified.direct)&&r.jsx(fe,{headline:"Direct Changes",type:J.Direct,changes:a.changes.modified.direct.map(({model_name:I})=>I)}),((m=(p=a==null?void 0:a.changes)==null?void 0:p.modified)==null?void 0:m.indirect)!=null&&ue((j=a==null?void 0:a.changes)==null?void 0:j.modified.indirect)&&r.jsx(fe,{headline:"Indirectly Modified",type:J.Indirect,changes:a.changes.modified.indirect.map(I=>I.model_name)}),((x=a==null?void 0:a.changes)==null?void 0:x.removed)!=null&&ue((o=a==null?void 0:a.changes)==null?void 0:o.removed)&&r.jsx(fe,{headline:"Removed Models",type:J.Remove,changes:a.changes.removed})]})})}function Ge({onSelect:e,environment:t,disabled:l,side:a="right",className:d,showAddEnvironemnt:i=!0,size:n=X.sm}){const s=B(p=>p.environments),u=B(p=>p.setEnvironment),b=B(p=>p.removeLocalEnvironment),g=it(pe.Button);return r.jsx(pe,{children:({close:p})=>r.jsxs(r.Fragment,{children:[r.jsxs(g,{variant:re.Alternative,size:n,disabled:l,className:L(d),children:[r.jsx("span",{className:"block overflow-hidden truncate",children:t.name}),r.jsx("span",{className:"pointer-events-none inset-y-0 right-0 flex items-center pl-2",children:r.jsx(ut,{className:"h-4 w-4","aria-hidden":"true"})})]}),r.jsx(xe,{as:c.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:r.jsxs("div",{className:L("absolute top-9 overflow-hidden shadow-xl bg-theme border-2 border-primary-20 rounded-md flex flex-col z-10",a==="left"&&"left-0",a==="right"&&"right-0"),children:[r.jsxs(pe.Items,{className:"overflow-auto max-h-80 py-2 scrollbar scrollbar--vertical",children:[Array.from(s).map(m=>r.jsx(pe.Item,{children:({active:j})=>r.jsxs("div",{onClick:x=>{x.stopPropagation(),u(m),e==null||e()},className:L("flex justify-between items-center px-4 py-1 cursor-pointer overflow-auto",j&&"bg-primary-10",m===t&&"pointer-events-none cursor-default bg-secondary-10"),children:[r.jsxs("div",{className:"flex items-start",children:[r.jsx(ct,{className:L("w-4 h-4 text-primary-500 mt-1",j&&"opacity-10",m!==t&&"opacity-0")}),r.jsxs("span",{className:"block",children:[r.jsxs("span",{className:"flex items-center",children:[r.jsx("span",{className:L("block truncate ml-2",m.isSyncronized&&"text-primary-500"),children:m.name}),r.jsxs("small",{className:"block ml-2",children:["(",m.type,")"]})]}),m.isDefault&&r.jsx("span",{className:"flex ml-2",children:r.jsx("small",{className:"text-xs text-neutral-500",children:"Default Environment"})})]})]}),m.isLocal&&m!==t&&r.jsx(ne,{className:"my-0 mx-0",size:X.xs,variant:re.Neutral,onClick:x=>{x.stopPropagation(),b(m)},children:"-"})]})},m.name)),i&&r.jsxs(r.Fragment,{children:[r.jsx(Ce,{}),r.jsx(et,{onAdd:p,className:"mt-2 px-2"})]})]}),r.jsx(Ce,{})]})})]})})}function et({onAdd:e,className:t,label:l="Add",size:a=X.sm}){const d=B(p=>p.getNextEnvironment),i=B(p=>p.isExistingEnvironment),n=B(p=>p.addLocalEnvironment),[s,u]=c.useState(""),[b,g]=c.useState(d().name);return r.jsxs("div",{className:L("flex w-full items-center",t),children:[r.jsx(dt,{className:"my-0 mx-0 mr-4 min-w-[10rem] w-full",size:a,placeholder:"Environment",value:s,onInput:p=>{p.stopPropagation(),u(p.target.value)}}),r.jsx(ne,{className:"my-0 mx-0 font-bold",size:a,disabled:mt(s)||i(s),onClick:p=>{p.stopPropagation(),n(s,b),u(""),g(d().name),e==null||e()},children:l})]})}function fe({headline:e,type:t,changes:l}){const[a,d]=c.useState(!1);return r.jsx(ae,{onMouseEnter:()=>{d(!0)},onMouseLeave:()=>{d(!1)},className:"relative flex",children:()=>r.jsxs(r.Fragment,{children:[r.jsx("span",{className:L("inline-block ml-1 px-2 rounded-full text-xs font-bold text-neutral-100 cursor-default border border-inherit",t===J.Add&&"bg-success-500 border-success-500",t===J.Remove&&"bg-danger-500 border-danger-500",t===J.Direct&&"bg-secondary-500 border-secondary-500",t===J.Indirect&&"bg-warning-500 border-warning-500",t==="metadata"&&"bg-neutral-500 border-neutral-500"),children:l.length}),r.jsx(xe,{show:a,as:c.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:r.jsx(ae.Panel,{className:"absolute right-1 z-10 mt-8 transform flex p-2 bg-theme-lighter shadow-xl focus:ring-2 ring-opacity-5 rounded-lg ",children:r.jsx(Be,{headline:e,type:t,className:"w-full h-full max-h-[40vh] overflow-hidden overflow-y-auto ",children:r.jsx(Be.Default,{type:t,changes:l})})})})]})})}function bn({headline:e,error:t}){const[l,a]=c.useState(!1);return r.jsx(ae,{onMouseEnter:()=>{a(!0)},onMouseLeave:()=>{a(!1)},className:"relative flex",children:()=>r.jsxs(r.Fragment,{children:[r.jsx("span",{title:"Latest",className:"block ml-1 px-2 first-child:ml-0 rounded-full border border-danger-500 bg-danger-500 text-neutral-100 text-xs text-center cursor-pointer",children:r.jsx("span",{children:"Error"})}),r.jsx(xe,{show:l,as:c.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:r.jsx(ae.Panel,{className:"absolute right-0 z-10 mt-8 transform flex min-w-[10rem] ",children:r.jsxs("div",{className:L("flex flex-col rounded-md p-4 bg-danger-100 w-full text-danger-700"),children:[e!=null&&r.jsx("h4",{className:L("mb-2 font-bold whitespace-nowrap"),children:e}),r.jsx("p",{className:"text-xs",children:t.detail??t.message})]})})})]})})}function Pn({plan:e}){const t=Xe(),l=B(s=>s.environment),a=U(s=>s.state),d=U(s=>s.setState),i=U(s=>s.setAction);function n(){d(k.Cancelling),i(ee.Cancelling),pt(t).catch(console.error).finally(()=>{i(ee.None),d(k.Cancelled)})}return r.jsx(ae,{className:"relative flex",children:()=>r.jsxs(r.Fragment,{children:[r.jsx(ae.Button,{className:L("inline-block ml-1 px-2 py-[3px] rounded-[4px] text-xs font-bold",In(a)),children:e==null?0:1}),r.jsx(xe,{as:c.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:r.jsx(ae.Panel,{className:"absolute right-1 z-10 mt-8 transform",children:r.jsxs("div",{className:"overflow-hidden rounded-lg bg-theme shadow-lg ring-1 ring-black ring-opacity-5",children:[r.jsx(Ie,{tasks:e.tasks,children:({total:s,completed:u,models:b,completedBatches:g,totalBatches:p})=>r.jsxs(r.Fragment,{children:[r.jsx(Ie.Summary,{environment:l.name,planState:a,headline:"Most Recent Plan",completed:u,total:s,completedBatches:g,totalBatches:p,updateType:e.type===be.Virtual?"Virtual":"Backfill",updatedAt:e.updated_at}),b!=null&&r.jsx(Ie.Details,{models:b,showBatches:e.type!==be.Virtual,showVirtualUpdate:e.type===be.Virtual,showProgress:!0})]})}),r.jsx("div",{className:"my-4 px-4",children:a===k.Applying&&r.jsx(ne,{size:X.sm,variant:re.Danger,className:"mx-0",onClick:s=>{s.stopPropagation(),n()},children:"Cancel"})})]})})})]})})}function In(e){return e===k.Finished?"bg-success-500 text-light":e===k.Failed?"bg-danger-500 text-light":e===k.Applying?"bg-secondary-500 text-light":"bg-neutral-100 text-neutral-500"}function wn(){const e=ft(),t=vt(),l=Xe(),{setIsPlanOpen:a}=xt(),d=B(h=>h.addSyncronizedEnvironments),i=B(h=>h.setModels),n=U(h=>h.activePlan),s=U(h=>h.updateTasks),u=Pe(h=>h.project),b=Pe(h=>h.setFiles),g=Pe(h=>h.setProject),[p]=Nt(),{data:m,refetch:j}=ht(),{data:x,refetch:o}=gt(),{data:I,refetch:N}=qe(),f=c.useCallback(de(N,1e3,!0),[N]),A=c.useCallback(de(o,1e3,!0),[o]),S=c.useCallback(de(j,1e3,!0),[j]);c.useEffect(()=>{const h=p("tasks",s),T=p("models",i);return f(),A(),S(),()=>{f.cancel(),A.cancel(),S.cancel(),yt(l),bt(l),Pt(l),h==null||h(),T==null||T()}},[]),c.useEffect(()=>{e.pathname===oe.Ide&&t(oe.IdeEditor)},[e]),c.useEffect(()=>{I==null||It(Object.keys(I))||d(Object.values(I))},[I]),c.useEffect(()=>{i(m)},[m]),c.useEffect(()=>{b((u==null?void 0:u.allFiles)??[])},[u]),c.useEffect(()=>{g(x)},[x]);function v(){a(!0)}const M=e.pathname===oe.IdeEditor;return r.jsxs(Et.Page,{children:[r.jsxs("div",{className:"w-full flex justify-between items-center min-h-[2rem] z-50",children:[r.jsxs("div",{className:"px-3 flex items-center whitespace-nowrap",children:[r.jsxs("h3",{className:"font-bold text-primary-500",children:[r.jsx("span",{className:"inline-block",children:"/"}),x==null?void 0:x.name]}),r.jsx(St,{className:"w-8 mx-4 text-neutral-50"}),r.jsx(ne,{size:X.sm,variant:re.Neutral,children:M?r.jsx(Le,{to:oe.IdeDocs,children:"Docs"}):r.jsx(Le,{to:oe.IdeEditor,children:"Editor"})})]}),M&&r.jsxs("div",{className:"px-3 flex items-center min-w-[10rem] justify-end",children:[r.jsx(gn,{showRunPlan:v}),n!=null&&r.jsx(Pn,{plan:n})]})]}),r.jsx(Ce,{}),r.jsx(jt,{})]})}export{wn as default};
