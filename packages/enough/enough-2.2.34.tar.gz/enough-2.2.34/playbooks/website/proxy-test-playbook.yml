- name: reverse proxy for theproxy
  hosts: proxy-service-group
  become: true

  roles:
    - role: proxy
      vars:
        website_proxy_name: "theproxy"
        website_proxy_pass: "https://{{ domain }}"
        website_proxy_monitor_string: "Enough"


- name: reverse proxy for othername
  hosts: proxy-service-group
  become: true

  pre_tasks:
    - name: set CNAME othername
      nsupdate:
        server: "127.0.0.1"
        zone: "{{ domain }}"
        record: "othername.{{ domain }}."
        ttl: 1800
        type: CNAME
        value: "{{ groups['proxy-service-group'][0] }}.{{ domain }}."
      delegate_to: "{{ item }}"
      loop: "{{groups['bind-service-group']}}"

  roles:
    - role: proxy
      vars:
        website_proxy_fqdn: "othername.{{ domain }}"
        website_proxy_pass: "https://{{ domain }}"
        website_proxy_monitor_string: "Enough"
